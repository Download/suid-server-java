<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Suid-server-java by Download</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Suid-server-java</h1>
        <h2>Suid-server implementation for the Java EE technology stack.</h2>
        <a href="https://github.com/Download/suid-server-java" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="suid-server-java-v0100" class="anchor" href="#suid-server-java-v0100" aria-hidden="true"><span class="octicon octicon-link"></span></a>suid-server-java v0.10.0</h1>

<p>Suid-server implementation for the Java EE technology stack.<br></p>

<p>Suids are distributed Service-Unique IDs that are short and sweet.<br>
See the main <a href="https://download.github.io/suid/">project</a> for details.</p>

<h2>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h2>

<ul>
<li>
<a href="http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0.jar">suid-server-java-0.10.0.jar</a> (<a href="http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0.jar.asc">signature</a>)</li>
<li>
<a href="http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-sources.jar">suid-server-java-0.10.0-sources.jar</a> (<a href="http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-sources.jar.asc">signature</a>)</li>
<li>
<a href="http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-javadoc.jar">suid-server-java-0.10.0-javadoc.jar</a> (<a href="http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-javadoc.jar.asc">signature</a>)</li>
</ul>

<h2>
<a id="maven-coordinates" class="anchor" href="#maven-coordinates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maven coordinates:</h2>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;ws.suid&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;suid-server-java&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;0.10.0&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<ul>
<li><a href="#create-a-database-and-user">Create a database and user</a></li>
<li><a href="#create-the-suid-table">Create the suid table</a></li>
<li><a href="#insert-the-first-record-in-the-new-table">Insert the first record in the new table</a></li>
<li><a href="#configure-a-datasource">Configure a datasource</a></li>
<li><a href="#add-the-jar-to-web-inf-lib">Add the jar to WEB-INF/lib</a></li>
<li><a href="#add-suidrecord-to-persistence-xml">Add SuidRecord to persistence.xml</a></li>
<li><a href="#optional-add-a-servlet-mapping-to-web-xml">Optional: Add a servlet mapping to web.xml</a></li>
</ul>

<h3>
<a id="create-a-database-and-user" class="anchor" href="#create-a-database-and-user" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a database and user</h3>

<p>In the examples below we are assuming a MySQL database, but any database that supports 
JPA2 can be used.</p>

<div class="highlight highlight-source-sql"><pre><span class="pl-k">CREATE</span> <span class="pl-k">SCHEMA</span> <span class="pl-en">IF</span> NOT EXISTS <span class="pl-s"><span class="pl-pds">`</span>suiddb<span class="pl-pds">`</span></span> DEFAULT CHARACTER <span class="pl-k">SET</span> utf8mb4 COLLATE utf8mb4_unicode_ci;
<span class="pl-k">CREATE</span> <span class="pl-k">USER</span> '<span class="pl-en">username</span>'@<span class="pl-s"><span class="pl-pds">'</span>hostname<span class="pl-pds">'</span></span> IDENTIFIED BY <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>;
<span class="pl-k">GRANT</span> ALL PRIVILEGES <span class="pl-k">ON</span> <span class="pl-s"><span class="pl-pds">`</span>suiddb<span class="pl-pds">`</span></span>.<span class="pl-k">*</span> TO <span class="pl-s"><span class="pl-pds">'</span>username<span class="pl-pds">'</span></span>@<span class="pl-s"><span class="pl-pds">'</span>hostname<span class="pl-pds">'</span></span>;</pre></div>

<h3>
<a id="create-the-suid-table" class="anchor" href="#create-the-suid-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the suid table</h3>

<div class="highlight highlight-source-sql"><pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">IF</span> NOT EXISTS suid (
    block <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span> <span class="pl-k">PRIMARY KEY</span> AUTO_INCREMENT,
    shard TINYINT <span class="pl-k">NOT NULL</span>
);</pre></div>

<h3>
<a id="insert-the-first-record-in-the-new-table" class="anchor" href="#insert-the-first-record-in-the-new-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Insert the first record in the new table</h3>

<div class="highlight highlight-source-sql"><pre><span class="pl-k">INSERT INTO</span> suid(shard) <span class="pl-k">VALUES</span>(<span class="pl-c1">0</span>);</pre></div>

<p><em>Note</em>: This configures the shard ID as 0.<br> 
<em>See</em>: <a href="#sharding">Sharding</a> | <a href="#configure-sharding">Configure sharding</a></p>

<h3>
<a id="configure-a-datasource" class="anchor" href="#configure-a-datasource" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure a datasource</h3>

<p>Using the tools for your preferred server, add a new DataSource that can connect to the database we just created. In the examples below we are configuring a MySQL database on JBoss/WildFly, but all
database and EE vendors that support JPA2 can be used.</p>

<h4>
<a id="using-jboss-cli" class="anchor" href="#using-jboss-cli" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using JBoss CLI</h4>

<pre><code>jboss-cli -c "data-source add --name=MyDataSource --jndi-name=java:/jdbc/MyDataSource --driver-name=mysql --connection-url=jdbc:mysql://hostname:3306/suiddb --user-name=username --password=password"
</code></pre>

<h4>
<a id="using-standalonexml" class="anchor" href="#using-standalonexml" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using standalone.xml</h4>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">datasource</span> <span class="pl-e">jndi-name</span>=<span class="pl-s"><span class="pl-pds">"</span>java:/jdbc/MyDataSource<span class="pl-pds">"</span></span> <span class="pl-e">pool-name</span>=<span class="pl-s"><span class="pl-pds">"</span>MyDataSource<span class="pl-pds">"</span></span> <span class="pl-e">enabled</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">use-java-context</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> <span class="pl-e">use-ccm</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">connection-url</span>&gt;jdbc:mysql://localhost:3306/suiddb&lt;/<span class="pl-ent">connection-url</span>&gt;
    &lt;<span class="pl-ent">driver</span>&gt;mysql&lt;/<span class="pl-ent">driver</span>&gt;
    &lt;<span class="pl-ent">pool</span>&gt;&lt;<span class="pl-ent">flush-strategy</span>&gt;IdleConnections&lt;/<span class="pl-ent">flush-strategy</span>&gt;&lt;/<span class="pl-ent">pool</span>&gt;
    &lt;<span class="pl-ent">security</span>&gt;
        &lt;<span class="pl-ent">user-name</span>&gt;root&lt;/<span class="pl-ent">user-name</span>&gt;
        &lt;<span class="pl-ent">password</span>&gt;secret&lt;/<span class="pl-ent">password</span>&gt;
    &lt;/<span class="pl-ent">security</span>&gt;
    &lt;<span class="pl-ent">validation</span>&gt;
        &lt;<span class="pl-ent">check-valid-connection-sql</span>&gt;SELECT 1&lt;/<span class="pl-ent">check-valid-connection-sql</span>&gt;
        &lt;<span class="pl-ent">background-validation</span>&gt;true&lt;/<span class="pl-ent">background-validation</span>&gt;
        &lt;<span class="pl-ent">background-validation-millis</span>&gt;60000&lt;/<span class="pl-ent">background-validation-millis</span>&gt;
    &lt;/<span class="pl-ent">validation</span>&gt;
&lt;/<span class="pl-ent">datasource</span>&gt;</pre></div>

<h3>
<a id="add-the-jar-to-web-inflib" class="anchor" href="#add-the-jar-to-web-inflib" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add the jar to WEB-INF/lib</h3>

<p>If you build your webapp with Maven, add a dependency using the Maven coordinates mentioned above. Otherwise, copy <code>suid-server-java-0.10.0.jar</code> to your <code>WEB-INF/lib</code> folder.</p>

<h3>
<a id="add-suidrecord-to-persistencexml" class="anchor" href="#add-suidrecord-to-persistencexml" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add SuidRecord to persistence.xml</h3>

<p>Suid-server-java uses JPA, so make sure JPA can find it by adding the <code>SuidRecord</code> class
to your webapp's <code>persistence.xml</code>:</p>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">persistence</span> <span class="pl-e">version</span>=<span class="pl-s"><span class="pl-pds">"</span>2.1<span class="pl-pds">"</span></span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://xmlns.jcp.org/xml/ns/persistence<span class="pl-pds">"</span></span>
             <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span>
             <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">"</span>http://xmlns.jcp.org/xml/ns/persistence</span>
<span class="pl-s">             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">persistence-unit</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>MyPersistenceUnit<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">description</span>&gt;JPA Persistence Unit.&lt;/<span class="pl-ent">description</span>&gt;
        &lt;<span class="pl-ent">jta-data-source</span>&gt;jdbc/MyDataSource&lt;/<span class="pl-ent">jta-data-source</span>&gt;
        &lt;<span class="pl-ent">exclude-unlisted-classes</span>&gt;false&lt;/<span class="pl-ent">exclude-unlisted-classes</span>&gt;
        &lt;<span class="pl-ent">class</span>&gt;ws.suid.SuidRecord&lt;/<span class="pl-ent">class</span>&gt;
    &lt;/<span class="pl-ent">persistence-unit</span>&gt;
&lt;/<span class="pl-ent">persistence</span>&gt;</pre></div>

<p>Note the <code>class</code> element. I always add <code>exclude-unlisted-classes</code> as well and set it
to <code>false</code>, but this is not needed for suid-server-java.</p>

<h3>
<a id="optional-add-a-servlet-mapping-to-webxml" class="anchor" href="#optional-add-a-servlet-mapping-to-webxml" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional: Add a servlet mapping to web.xml</h3>

<p>Suid-server-java includes a servlet named <code>SuidServlet</code> that will register itself to listen
for requests on url <code>/suid/suid.json</code>. If you want to map it to a different url (or otherwise override it's configuration) you can configure it in <code>web.xml</code> like you can with any other servlet. Use <code>servlet-name</code> = <code>ws.suid.SuidServlet</code> to <em>override</em> the default configuration, or a different servlet name to <em>augment</em> it.</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">servlet-mapping</span>&gt;
    &lt;<span class="pl-ent">servlet-name</span>&gt;ws.suid.SuidServlet&lt;/<span class="pl-ent">servlet-name</span>&gt;
    &lt;<span class="pl-ent">url-pattern</span>&gt;/super-suid/suid.json&lt;/<span class="pl-ent">url-pattern</span>&gt;
&lt;/<span class="pl-ent">servlet-mapping</span>&gt;</pre></div>

<p>In the example above we specified a matching servlet name, so this <em>overrides</em> the default configuration. SuidServlet will be listening to one url:</p>

<ul>
<li>
<code>/super-suid/suid.json</code> (overridden)</li>
</ul>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">servlet-mapping</span>&gt;
    &lt;<span class="pl-ent">servlet-name</span>&gt;SuperSuidServlet&lt;/<span class="pl-ent">servlet-name</span>&gt;
    &lt;<span class="pl-ent">url-pattern</span>&gt;/super-suid/suid.json&lt;/<span class="pl-ent">url-pattern</span>&gt;
&lt;/<span class="pl-ent">servlet-mapping</span>&gt;</pre></div>

<p>In this example we specified a different servlet name, so this <em>augments</em> the default configuration. SuidServlet will be listening to two urls:</p>

<ul>
<li>
<code>/suid/suid.json</code> (default) </li>
<li>
<code>/super-suid/suid.json</code> (augmented)</li>
</ul>

<h2>
<a id="sharding" class="anchor" href="#sharding" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sharding</h2>

<p>To prevent a single point of failure, the total ID space for each domain is divided into 2 sections (called shards). 
This allows you to set up separate servers with their own databases to give out ID blocks in their own shard. This way there can be two different suid servers for a single domain, each with their own database, and they don't need to communicate at all. All you need to do is make sure that each server is configured with it's own shard ID, <code>0</code> or <code>1</code>.</p>

<h3>
<a id="configure-sharding" class="anchor" href="#configure-sharding" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure sharding</h3>

<p>To configure the shard ID we insert the first record in the suid table manually. The shard id on the existing record is used when inserting new records so once the first record is there the server can figure out the rest by itself. If we don't insert a first record, the shard ID defaults to <code>0</code>.
<em>SEE</em>: <a href="#insert-the-first-record-in-the-new-table">Insert the first record in the new table</a></p>

<h2>
<a id="copyright" class="anchor" href="#copyright" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright</h2>

<p>Copyright (c) 2015 by <a href="http://StijnDeWitt.com">Stijn de Witt</a>. Some rights reserved.</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Creative Commons Attribution 4.0 International (CC BY 4.0)
<a href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/Download/suid-server-java/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Download/suid-server-java/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Download/suid-server-java"></a> is maintained by <a href="https://github.com/Download">Download</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
