<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Suid-server-java by Download</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Suid-server-java</h1>
        <h2>Suid-server implementation for the Java EE technology stack.</h2>
        <a href="https://github.com/Download/suid-server-java" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="suid-server-java" class="anchor" href="#suid-server-java" aria-hidden="true"><span class="octicon octicon-link"></span></a>suid-server-java</h1>

<p>Suid-server implementation for the Java EE technology stack.</p>

<p>Suids are distributed Service-Unique IDs that are short and sweet.
See the main <a href="https://download.github.io/suid/">project</a> for details.</p>

<h2>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h2>

<ul>
<li><a href="https://github.com/Download/suid-server-java/releases/download/0.9.0/suid-server-java-0.9.0.jar">suid-server-java-0.9.0.jar</a></li>
</ul>

<p>Maven coordinates:</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;ws.suid&lt;/groupId&gt;
    &lt;artifactId&gt;suid-server-java&lt;/artifactId&gt;
    &lt;version&gt;0.9.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<ul>
<li><a href="#create-a-mysql-database-and-user">Create a MySQL database and user</a></li>
<li><a href="#create-the-suid-table">Create the suid table</a></li>
<li><a href="#insert-the-first-record-in-the-new-table">Insert the first record in the new table</a></li>
<li><a href="#configure-a-mysql-datasource">Configure a MySQL datasource</a></li>
<li><a href="#add-the-jar-to-web-inf-lib">Add the jar to WEB-INF/lib</a></li>
<li><a href="#add-a-servlet-definition-and-mapping-to-web-xml">Add a servlet definition and mapping to web.xml</a></li>
</ul>

<h3>
<a id="create-a-mysql-database-and-user" class="anchor" href="#create-a-mysql-database-and-user" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a MySQL database and user</h3>

<pre><code>CREATE SCHEMA IF NOT EXISTS `suiddb` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'username'@'hostname' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON `suiddb`.* TO 'username'@'hostname';
</code></pre>

<p><em>NOTE</em>: Only MySQL is supported at the moment.</p>

<h3>
<a id="create-the-suid-table" class="anchor" href="#create-the-suid-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the suid table</h3>

<pre><code>CREATE TABLE IF NOT EXISTS suid (
    block BIGINT NOT NULL AUTO_INCREMENT,
    shard TINYINT NOT NULL,
    PRIMARY KEY (block),
    UNIQUE KEY shard (shard)
);
</code></pre>

<h3>
<a id="insert-the-first-record-in-the-new-table" class="anchor" href="#insert-the-first-record-in-the-new-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Insert the first record in the new table</h3>

<pre><code>INSERT INTO suid(shard) VALUES(0);
</code></pre>

<p><em>Note</em>: This configures the shard ID as 0. 
<em>See</em>: <a href="#sharding">Sharding</a> <a href="#using-the-database">Using the database</a></p>

<h3>
<a id="configure-a-mysql-datasource" class="anchor" href="#configure-a-mysql-datasource" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure a MySQL datasource</h3>

<p>Using the tools for your preferred server, add a new DataSource called <code>SuidRWDS</code> that can connect to the database we just created.
For example, using JBoss CLI it could look like this:
    jboss-cli -c "data-source add --name=SuidRWDS --jndi-name=java:/jdbc/SuidRWDS --driver-name=mysql --connection-url=jdbc:mysql://hostname:3306/suiddb --user-name=username --password=password"</p>

<h3>
<a id="add-the-jar-to-web-inflib" class="anchor" href="#add-the-jar-to-web-inflib" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add the jar to WEB-INF/lib</h3>

<p>Download or build the jar and add it to your web application's <code>WEB-INF/lib</code> folder.</p>

<h3>
<a id="add-a-servlet-definition-and-mapping-to-webxml" class="anchor" href="#add-a-servlet-definition-and-mapping-to-webxml" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add a servlet definition and mapping to web.xml</h3>

<pre><code>&lt;servlet&gt;
    &lt;description&gt;&lt;/description&gt;
    &lt;display-name&gt;SuidServlet&lt;/display-name&gt;
    &lt;servlet-name&gt;SuidServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;ws.suid.SuidServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Shard number to use when no shard number is in the `suid` table yet. Will
            be ignored if there is already a record in the suid table. When supplied it
            should be in the range from 0 .. 3.
        &lt;/description&gt;
        &lt;param-name&gt;shard&lt;/param-name&gt;
        &lt;param-value&gt;0&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;SuidServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/suid/suid.json&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>

<h2>
<a id="sharding" class="anchor" href="#sharding" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sharding</h2>

<p>To prevent a single point of failure, the total ID space for each domain is divided into 4 sections (called shards). 
This allows you to set up separate servers with their own databases to give out ID blocks in their own shard. This way there can be up to 4 different suid servers for a single domain, each with their own database, and they don't need to communicate at all. All you need to do is make sure that each server is configured with it's own shard ID.</p>

<p>To configure the shard id of the server, there are two options:
1. <a href="#using-a-servlet-configuration-parameter">Using a servlet configuration parameter</a>
2. <a href="#using-the-database">Using the database</a></p>

<h3>
<a id="using-a-servlet-configuration-parameter" class="anchor" href="#using-a-servlet-configuration-parameter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using a servlet configuration parameter</h3>

<p>This works by setting the servlet configuration parameter <code>shard</code> to the shard ID of the server you are configuring in your webapp's <code>web.xml</code> file. Refer to the previous section for an example. 
<em>NOTE</em>: This option only works if the suid table is still empty.
<em>SEE</em>: <a href="#add-a-servlet-definition-and-mapping-to-web-xml">Add a servlet definition and mapping to web.xml</a></p>

<h3>
<a id="using-the-database" class="anchor" href="#using-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the database</h3>

<p>The preferred way of configuring the shard ID is by just inserting the first record in the suid table manually. The shard id is used when inserting new records so once the first record is there the server can figure out the rest by itself. All the servlet configuration parameter does is tell the SuidServlet to insert this first record if it's not yet there.
<em>SEE</em>: <a href="#insert-the-first-record-in-the-new-table">Insert the first record in the new table</a></p>

<h2>
<a id="copyright" class="anchor" href="#copyright" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright</h2>

<p>Copyright (c) 2015 by Stijn de Witt. Some rights reserved.</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Creative Commons Attribution 4.0 International (CC BY 4.0)
<a href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/Download/suid-server-java/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Download/suid-server-java/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Download/suid-server-java"></a> is maintained by <a href="https://github.com/Download">Download</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
