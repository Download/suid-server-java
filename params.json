{"name":"Suid-server-java","tagline":"Suid-server implementation for the Java EE technology stack.","body":"# suid-server-java v0.10.0\r\nSuid-server implementation for the Java EE technology stack.<br>\r\n\r\nSuids are distributed Service-Unique IDs that are short and sweet.<br>\r\nSee the main [project](https://download.github.io/suid/) for details.\r\n\r\n## Download\r\n* [suid-server-java-0.10.0.jar](http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0.jar) ([signature](http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0.jar.asc))\r\n* [suid-server-java-0.10.0-sources.jar](http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-sources.jar) ([signature](http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-sources.jar.asc))\r\n* [suid-server-java-0.10.0-javadoc.jar](http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-javadoc.jar) ([signature](http://search.maven.org/remotecontent?filepath=ws/suid/suid-server-java/0.10.0/suid-server-java-0.10.0-javadoc.jar.asc))\r\n\r\n## Maven coordinates:\r\n```xml\r\n<dependency>\r\n\t<groupId>ws.suid</groupId>\r\n\t<artifactId>suid-server-java</artifactId>\r\n\t<version>0.10.0</version>\r\n</dependency>\r\n```\r\n## Usage\r\n* [Create a database and user](#create-a-database-and-user)\r\n* [Create the suid table](#create-the-suid-table)\r\n* [Insert the first record in the new table](#insert-the-first-record-in-the-new-table)\r\n* [Configure a datasource](#configure-a-datasource)\r\n* [Add the jar to WEB-INF/lib](#add-the-jar-to-web-inf-lib)\r\n* [Add SuidRecord to persistence.xml](#add-suidrecord-to-persistence-xml)\r\n* [Optional: Add a servlet mapping to web.xml](#optional-add-a-servlet-mapping-to-web-xml)\r\n\r\n### Create a database and user\r\nIn the examples below we are assuming a MySQL database, but any database that supports \r\nJPA2 can be used.\r\n```sql\r\nCREATE SCHEMA IF NOT EXISTS `suiddb` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\r\nCREATE USER 'username'@'hostname' IDENTIFIED BY 'password';\r\nGRANT ALL PRIVILEGES ON `suiddb`.* TO 'username'@'hostname';\r\n```\r\n\r\n### Create the suid table\r\n```sql\r\nCREATE TABLE IF NOT EXISTS suid (\r\n\tblock BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,\r\n\tshard TINYINT NOT NULL\r\n);\r\n```\r\n\r\n### Insert the first record in the new table\r\n```sql\r\nINSERT INTO suid(shard) VALUES(0);\r\n```\r\n*Note*: This configures the shard ID as 0.<br> \r\n*See*: [Sharding](#sharding) | [Configure sharding](#configure-sharding)\r\n\r\n### Configure a datasource\r\nUsing the tools for your preferred server, add a new DataSource that can connect to the database we just created. In the examples below we are configuring a MySQL database on JBoss/WildFly, but all\r\ndatabase and EE vendors that support JPA2 can be used.\r\n\r\n#### Using JBoss CLI\r\n\tjboss-cli -c \"data-source add --name=MyDataSource --jndi-name=java:/jdbc/MyDataSource --driver-name=mysql --connection-url=jdbc:mysql://hostname:3306/suiddb --user-name=username --password=password\"\r\n\r\n#### Using standalone.xml\r\n```xml\r\n<datasource jndi-name=\"java:/jdbc/MyDataSource\" pool-name=\"MyDataSource\" enabled=\"true\" use-java-context=\"true\" use-ccm=\"true\">\r\n    <connection-url>jdbc:mysql://localhost:3306/suiddb</connection-url>\r\n    <driver>mysql</driver>\r\n    <pool><flush-strategy>IdleConnections</flush-strategy></pool>\r\n    <security>\r\n        <user-name>root</user-name>\r\n        <password>secret</password>\r\n    </security>\r\n    <validation>\r\n        <check-valid-connection-sql>SELECT 1</check-valid-connection-sql>\r\n        <background-validation>true</background-validation>\r\n        <background-validation-millis>60000</background-validation-millis>\r\n    </validation>\r\n</datasource>\r\n```\r\n\r\n### Add the jar to WEB-INF/lib\r\nIf you build your webapp with Maven, add a dependency using the Maven coordinates mentioned above. Otherwise, copy `suid-server-java-0.10.0.jar` to your `WEB-INF/lib` folder.\r\n\r\n### Add SuidRecord to persistence.xml\r\nSuid-server-java uses JPA, so make sure JPA can find it by adding the `SuidRecord` class\r\nto your webapp's `persistence.xml`:\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<persistence version=\"2.1\" xmlns=\"http://xmlns.jcp.org/xml/ns/persistence\"\r\n             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n             xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/persistence\r\n             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd\">\r\n\t<persistence-unit name=\"MyPersistenceUnit\">\r\n\t\t<description>JPA Persistence Unit.</description>\r\n\t\t<jta-data-source>jdbc/MyDataSource</jta-data-source>\r\n\t\t<exclude-unlisted-classes>false</exclude-unlisted-classes>\r\n\t\t<class>ws.suid.SuidRecord</class>\r\n\t</persistence-unit>\r\n</persistence>\r\n```\r\nNote the `class` element. I always add `exclude-unlisted-classes` as well and set it\r\nto `false`, but this is not needed for suid-server-java.\r\n\r\n### Optional: Add a servlet mapping to web.xml\r\nSuid-server-java includes a servlet named `SuidServlet` that will register itself to listen\r\nfor requests on url `/suid/suid.json`. If you want to map it to a different url (or otherwise override it's configuration) you can configure it in `web.xml` like you can with any other servlet. Use `servlet-name` = `ws.suid.SuidServlet` to *override* the default configuration, or a different servlet name to *augment* it.\r\n\r\n```xml\r\n<servlet-mapping>\r\n\t<servlet-name>ws.suid.SuidServlet</servlet-name>\r\n\t<url-pattern>/super-suid/suid.json</url-pattern>\r\n</servlet-mapping>\r\n```\r\nIn the example above we specified a matching servlet name, so this *overrides* the default configuration. SuidServlet will be listening to one url:\r\n* `/super-suid/suid.json` (overridden)\r\n\r\n```xml\r\n<servlet-mapping>\r\n\t<servlet-name>SuperSuidServlet</servlet-name>\r\n\t<url-pattern>/super-suid/suid.json</url-pattern>\r\n</servlet-mapping>\r\n```\r\nIn this example we specified a different servlet name, so this *augments* the default configuration. SuidServlet will be listening to two urls:\r\n* `/suid/suid.json` (default) \r\n* `/super-suid/suid.json` (augmented)\r\n\r\n\r\n## Sharding\r\nTo prevent a single point of failure, the total ID space for each domain is divided into 2 sections (called shards). \r\nThis allows you to set up separate servers with their own databases to give out ID blocks in their own shard. This way there can be two different suid servers for a single domain, each with their own database, and they don't need to communicate at all. All you need to do is make sure that each server is configured with it's own shard ID, `0` or `1`.\r\n\r\n### Configure sharding\r\nTo configure the shard ID we insert the first record in the suid table manually. The shard id on the existing record is used when inserting new records so once the first record is there the server can figure out the rest by itself. If we don't insert a first record, the shard ID defaults to `0`.\r\n*SEE*: [Insert the first record in the new table](#insert-the-first-record-in-the-new-table)\r\n\r\n## Copyright\r\nCopyright (c) 2015 by [Stijn de Witt](http://StijnDeWitt.com). Some rights reserved.\r\n\r\n## License\r\nCreative Commons Attribution 4.0 International (CC BY 4.0)\r\nhttps://creativecommons.org/licenses/by/4.0/\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}